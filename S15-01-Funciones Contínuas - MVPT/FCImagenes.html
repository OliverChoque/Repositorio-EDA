<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Búsqueda de Imágenes Similares</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
        }
        .container {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .image-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        .image-container img, .result-container img {
            width: 90px;
            height: 90px;
            object-fit: cover;
            cursor: pointer;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, border 0.3s ease;
        }
        .image-container img:hover, .result-container img:hover {
            transform: scale(1.1);
        }
        .selected {
            border: 3px solid #03a9f4;
        }
        .similar {
            border: 3px solid #8bc34a;
        }
        .result-container {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        h1, h2, h3 {
            width: 100%;
            text-align: center;
            font-size: 2em;
            color: #03a9f4;
        }
        #message {
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #9e9e9e;
        }
        .header {
            margin-bottom: 30px;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9em;
            color: #9e9e9e;
        }
        .button {
            display: inline-block;
            padding: 10px 20px;
            margin-top: 20px;
            font-size: 1em;
            color: #121212;
            background-color: #03a9f4;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        .button:hover {
            background-color: #0288d1;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Búsqueda de Imágenes Similares</h1>
            <div id="message">Haz clic en una imagen para encontrar imágenes similares.</div>
            <button class="button" onclick="resetSearch()">Resetear Búsqueda</button>
        </div>
        <div class="image-container" id="imageContainer"></div>
        <div class="result-container" id="resultContainer"></div>
        <div class="footer">
            <p>© 2024 Búsqueda de Imágenes Similares. Todos los derechos reservados.</p>
        </div>
    </div>
    <script>
        const images = [
            { id: 1, features: [0.5, 0.8], src: 'img/Up.jfif' },
            { id: 2, features: [0.6, 0.7], src: 'img/Stay.jfif' },
            { id: 3, features: [0.4, 0.9], src: 'img/Without You.jfif' },
            { id: 4, features: [0.7, 0.6], src: 'img/Watermelon Sugar.jfif' },
            { id: 5, features: [0.8, 0.5], src: 'img/Take My Breath.jfif' },
            { id: 6, features: [0.9, 0.4], src: 'img/Blinding Lights.jfif' },
            { id: 7, features: [0.3, 0.7], src: 'img/Savage Love.jfif' },
            { id: 8, features: [0.8, 0.6], src: 'img/Levitating.png' },
            { id: 9, features: [0.5, 0.9], src: 'img/Peaches.jfif' },
            { id: 10, features: [0.4, 0.8], src: 'img/Montero.jfif' },
            { id: 11, features: [0.6, 0.7], src: 'img/Drivers License.jfif' },
            { id: 12, features: [0.7, 0.8], src: 'img/Save Your Tears.jfif' },
            { id: 13, features: [0.5, 0.6], src: 'img/Good 4 U.png' },
            { id: 14, features: [0.8, 0.5], src: 'img/Kiss Me More.jfif' },
            { id: 15, features: [0.7, 0.6], src: 'img/Deja Vu.png' },
            { id: 16, features: [0.6, 0.9], src: 'img/Butter.jfif' },
            { id: 17, features: [0.4, 0.7], src: 'img/Therefore I Am.jfif' },
            { id: 18, features: [0.8, 0.5], src: 'img/Positions.jfif' },
            { id: 19, features: [0.7, 0.8], src: 'img/Rockstar.jfif' },
            { id: 20, features: [0.6, 0.4], src: 'img/Holy.jpg' },
            { id: 21, features: [0.5, 0.7], src: 'img/Dynamite.jfif' },
            { id: 22, features: [0.4, 0.6], src: 'img/Laugh Now Cry Later.jfif' },
            { id: 23, features: [0.9, 0.5], src: 'img/Whats Next.png' },
            { id: 24, features: [0.8, 0.7], src: 'img/34+35.jfif' },
            { id: 25, features: [0.7, 0.9], src: 'img/Holiday.jfif' },
            { id: 26, features: [0.6, 0.4], src: 'img/TikTok.png' },
            { id: 27, features: [0.5, 0.8], src: 'img/Fake Woke.jfif' },
            { id: 28, features: [0.4, 0.7], src: 'img/Best Friend.jfif' },
            { id: 29, features: [0.8, 0.5], src: 'img/Industry Baby.jfif' },
            { id: 30, features: [0.7, 0.6], src: 'img/Heartbreak Anniversary.jfif' },
            { id: 31, features: [0.6, 0.9], src: 'img/Back In Blood.jfif' },
            { id: 32, features: [0.5, 0.8], src: 'img/Telepatia.jfif' },
            { id: 33, features: [0.4, 0.7], src: 'img/Calling My Phone.jfif' },
            { id: 34, features: [0.9, 0.6], src: 'img/For The Night.jfif' },
            { id: 35, features: [0.8, 0.5], src: 'img/On My Way.jfif' },
            { id: 36, features: [0.7, 0.9], src: 'img/Go Crazy.jfif' },
            { id: 37, features: [0.6, 0.4], src: 'img/Body.jfif' },
            { id: 38, features: [0.5, 0.7], src: 'img/Mood.jfif' },
            { id: 39, features: [0.4, 0.6], src: 'img/Blame.jfif' },
            { id: 40, features: [0.8, 0.5], src: 'img/Forever Yours.jfif' },
            { id: 41, features: [0.7, 0.6], src: 'img/Heat Waves.jfif' },
            { id: 42, features: [0.6, 0.9], src: 'img/Scared.png' },
            { id: 43, features: [0.5, 0.8], src: 'img/Ski.jfif' },
            { id: 44, features: [0.4, 0.7], src: 'img/Flocky Flocky.jfif' },
        ];

        function euclideanDistance(a, b) {
            return Math.sqrt(a.reduce((sum, val, i) => sum + (val - b[i]) ** 2, 0));
        }

        class Node {
            constructor(points = [], references = [], medianDistances = []) {
                this.points = points;
                this.references = references;
                this.medianDistances = medianDistances;
                this.left = null;
                this.right = null;
            }
        }

        class MultiVPTree {
            constructor(points, numReferences = 2, leafSize = 10) {
                this.numReferences = numReferences;
                this.leafSize = leafSize;
                this.root = this.buildTree(points);
            }

            buildTree(points) {
                if (points.length <= this.leafSize) {
                    return { points: points };
                }

                const references = [];
                for (let i = 0; i < this.numReferences; i++) {
                    const index = Math.floor(Math.random() * points.length);
                    references.push(points[index]);
                }

                const distances = points.map(point => references.map(ref => euclideanDistance(point, ref)));

                const medianDistances = references.map((_, i) => this.median(distances.map(d => d[i])));
                const leftPoints = points.filter((_, idx) => distances[idx].every((d, i) => d <= medianDistances[i]));
                const rightPoints = points.filter((_, idx) => !leftPoints.includes(points[idx]));

                return {
                    references: references,
                    medianDistances: medianDistances,
                    left: this.buildTree(leftPoints),
                    right: this.buildTree(rightPoints)
                };
            }

            median(values) {
                values.sort((a, b) => a - b);
                const mid = Math.floor(values.length / 2);
                return values.length % 2 === 0 ? (values[mid - 1] + values[mid]) / 2 : values[mid];
            }

            search(query, k = 1) {
                return this._search(this.root, query, k);
            }

            _search(node, query, k) {
                if (node.points) {
                    const distances = node.points.map(point => euclideanDistance(query, point));
                    return node.points.map((point, idx) => [point, distances[idx]]).sort((a, b) => a[1] - b[1]).slice(0, k);
                }

                const queryDistances = node.references.map(ref => euclideanDistance(query, ref));

                const exploreLeft = queryDistances.every((d, i) => d <= node.medianDistances[i]);
                const bestBranch = exploreLeft ? node.left : node.right;
                const otherBranch = exploreLeft ? node.right : node.left;

                let bestResults = this._search(bestBranch, query, k);

                const bestDistances = bestResults.map(result => result[1]);
                if (queryDistances.some((d, i) => d <= node.medianDistances[i] + Math.max(...bestDistances))) {
                    const otherResults = this._search(otherBranch, query, k);
                    bestResults = bestResults.concat(otherResults).sort((a, b) => a[1] - b[1]).slice(0, k);
                }

                return bestResults;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const imageContainer = document.getElementById('imageContainer');
            const resultContainer = document.getElementById('resultContainer');
            const message = document.getElementById('message');

            images.forEach(img => {
                const imageElement = document.createElement('img');
                imageElement.src = img.src;
                imageElement.dataset.id = img.id;
                imageElement.classList.add('img-thumbnail');
                imageElement.addEventListener('click', () => {
                    document.querySelectorAll('.image-container img').forEach(el => el.classList.remove('selected'));
                    document.querySelectorAll('.result-container img').forEach(el => el.classList.remove('similar'));

                    imageElement.classList.add('selected');
                    const queryImage = images.find(i => i.id == img.id);
                    const tree = new MultiVPTree(images.map(img => img.features), 2, 10);
                    const similarImages = tree.search(queryImage.features, 5); // Mostrar las 5 imágenes más similares
                    displayResults(similarImages);
                });
                imageContainer.appendChild(imageElement);
            });

            function displayResults(similarImages) {
                resultContainer.innerHTML = '<h2>Imágenes Similares:</h2>';
                similarImages.forEach(result => {
                    const imgId = images.find(img => img.features.every((val, i) => val === result[0][i])).id;
                    const imageElement = document.createElement('img');
                    imageElement.src = images.find(img => img.id === imgId).src;
                    imageElement.classList.add('img-thumbnail', 'similar');
                    resultContainer.appendChild(imageElement);
                });
                message.innerHTML = 'Mostrando imágenes similares para la imagen seleccionada.';
            }

            window.resetSearch = () => {
                document.querySelectorAll('.image-container img').forEach(el => el.classList.remove('selected'));
                document.querySelectorAll('.result-container img').forEach(el => el.classList.remove('similar'));
                resultContainer.innerHTML = '';
                message.innerHTML = 'Haz clic en una imagen para encontrar imágenes similares.';
            };
        });
    </script>
</body>
</html>
